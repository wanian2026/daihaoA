# Web管理界面使用指南

## 功能特性

币安双向持仓策略系统提供了功能完整的Web管理界面，支持实时监控和手动干预。

### 核心功能

1. **实时监控**
   - 实时显示当前价格、ATR值
   - 持仓数量、浮盈情况
   - 策略运行状态
   - 交易统计

2. **持仓管理**
   - 查看所有持仓详情
   - 显示入场价格、止盈价格、止损价格
   - 实时计算浮盈

3. **交易历史**
   - 查看历史交易记录
   - 显示入场价、平仓价、盈亏情况
   - 支持最近50条记录

4. **手动干预**
   - 手动开多单
   - 手动开空单
   - 平仓所有持仓
   - 暂停/恢复策略

5. **实时日志**
   - 显示策略运行日志
   - 支持清空日志
   - 实时推送关键事件

## 启动方式

### 方式1：正常启动（推荐）

```bash
cd /workspace/projects
python src/main.py
```

启动后会显示：
```
==================================================
Web管理界面已启动
==================================================
访问地址: http://localhost:8000
==================================================
```

### 方式2：仅启动Web界面（不运行策略）

如果只想查看Web界面而不运行策略，可以单独启动：

```bash
uvicorn src.web.app:app --host 0.0.0.0 --port 8000
```

## 访问界面

启动后，在浏览器中访问：

- 本地访问：`http://localhost:8000`
- 局域网访问：`http://[服务器IP]:8000`

## 界面说明

### 主布局

界面分为左右两栏：

**左栏（75%）：**
- 策略状态卡片
- 持仓列表
- 交易历史
- 实时日志

**右栏（25%）：**
- 手动操作面板
- 策略控制面板
- 交易统计
- 每日统计

### 策略状态

显示关键指标：
- 当前价格：实时市场价格
- ATR值：当前ATR指标值
- 多单数量：当前持有多单数量
- 空单数量：当前持有空单数量
- 多单浮盈：多单总浮动盈亏
- 空单浮盈：空单总浮动盈亏
- 总浮盈：所有持仓总浮动盈亏
- 策略运行状态：运行中/已暂停/已停止

### 持仓列表

显示每个持仓的详细信息：
- 类型：多单/空单
- 入场价格：开仓时的价格
- 数量：持仓数量
- 止盈价格：止盈触发价格
- 止损价格：止损触发价格
- 浮盈：当前浮动盈亏

### 交易历史

显示历史交易记录：
- 时间：交易时间
- 类型：多单/空单
- 入场：入场价格
- 平仓：平仓价格
- 盈亏：实际盈亏（已扣除手续费）
- 原因：止盈/止损/手动平仓

### 手动操作

提供以下手动操作按钮：

1. **手动开多**：立即开一个多单
2. **手动开空**：立即开一个空单
3. **平仓所有持仓**：平掉所有多单和空单（需要确认）

### 策略控制

1. **暂停策略**：暂时停止策略的自动交易，但保持连接
2. **恢复策略**：恢复策略的自动交易

### 交易统计

显示策略运行以来的统计：
- 总交易次数
- 多单盈利次数
- 多单亏损次数
- 空单盈利次数
- 空单亏损次数
- 总盈利（已扣除手续费）
- 总亏损（已扣除手续费）
- 净盈利（总盈利 - 总亏损）

### 每日统计

显示当天的统计：
- 今日亏损
- 今日交易次数

## 实时更新

Web界面通过WebSocket实时更新数据：

1. **状态更新**：每5秒自动更新策略状态
2. **交易更新**：每当有交易发生时立即推送
3. **日志推送**：重要日志实时显示

## API接口

Web界面提供以下REST API接口：

### 策略状态
```
GET /api/status
```

### 持仓详情
```
GET /api/positions
```

### 交易历史
```
GET /api/trades?limit=100
```

### 当前配置
```
GET /api/config
```

### 手动开多
```
POST /api/manual/long
```

### 手动开空
```
POST /api/manual/short
```

### 平仓所有持仓
```
POST /api/close/all
```

### 暂停策略
```
POST /api/pause
```

### 恢复策略
```
POST /api/resume
```

### WebSocket连接
```
WS /ws
```

## WebSocket消息格式

### 状态更新
```json
{
  "type": "status_update",
  "data": {
    "current_price": 50000.0,
    "current_atr": 1000.0,
    "positions": {...},
    "stats": {...}
  },
  "timestamp": "2025-01-01T00:00:00"
}
```

### 交易更新
```json
{
  "type": "trade_update",
  "data": {
    "type": "long",
    "entry_price": 50000.0,
    "exit_price": 50900.0,
    "profit": 8.6,
    "reason": "止盈"
  },
  "timestamp": "2025-01-01T00:00:00"
}
```

### 日志更新
```json
{
  "type": "log_update",
  "data": {
    "message": "多单止盈触发",
    "level": "info"
  },
  "timestamp": "2025-01-01T00:00:00"
}
```

## 安全建议

1. **访问控制**：在生产环境中，建议配置防火墙限制访问
2. **HTTPS**：生产环境建议使用HTTPS
3. **认证**：可以添加API密钥或登录认证
4. **IP白名单**：限制只有特定IP可以访问

## 故障排除

### 无法访问Web界面

1. 检查防火墙设置
2. 确认端口8000未被占用
3. 检查策略是否正常启动

### WebSocket连接失败

1. 检查浏览器是否支持WebSocket
2. 查看浏览器控制台错误信息
3. 确认防火墙允许WebSocket连接

### 数据不更新

1. 检查策略是否正在运行
2. 查看日志确认是否有错误
3. 刷新页面重新连接

## 性能优化

- 日志最多保留500条
- 交易历史最多显示50条
- WebSocket自动重连（5秒间隔）
- 使用CDN加载Tailwind CSS

## 未来改进计划

- [ ] 添加用户认证
- [ ] 支持多策略同时管理
- [ ] 添加图表可视化
- [ ] 支持参数调整
- [ ] 添加告警通知
- [ ] 支持手机响应式布局优化
